package(default_visibility=['//agent_engine/engine:__subpackages__'])

cc_library(
    name='common_lib',
    srcs=glob([
        'common.cc',
    ]),
    hdrs=glob([
        'common.h',
        'creator_factory.h',
    ]),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        '//agent_engine/util:singleton',
    ],
    alwayslink=1
)

cc_library(
    name='binary_main_lib',
    srcs=glob([
        'main.cc',
    ]),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        ':worker_base_lib',
    ],
    alwayslink=1
)


cc_library(
    name='worker_base_lib',
    srcs=glob([
        'worker_base.cc',
        'base_module.cc',
        'module_manager.cc',
    ]),
    hdrs=glob([
        'worker_base.h',
        'base_module.h',
        'module_manager.h',
    ]),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        '//agent_engine/util:log',
        '//agent_engine/util:scope',
        '//agent_engine/util:option_parser',
        '//agent_engine/util:string_helper',
        '//agent_engine/util:file_util',
        '//agent_engine/util:singleton',
        ':common_lib',
    ],
    alwayslink=1
)

cc_library(
    name='worker_modules_lib',
    srcs=glob([
        'modules/agent_service_module.cc',
    ]),
    hdrs=glob([
        'modules/agent_service_module.h',
    ]),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        ':common_lib',
        ':worker_base_lib',
        '//agent_engine/network:grpc_server',
        "//agent_engine/engine/proto:agent_service_grpc",
    ],
    alwayslink=1
)



cc_library(
    name='admin_lib',
    srcs=glob(['admin_worker.cc']),
    hdrs=glob(['admin_worker.h']),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        ':worker_base_lib',
    ],
    alwayslink=1
)

cc_binary(
    name='admin_bin',
    srcs=['admin_worker_creator.cc'],
    copts=['-Werror'],
    visibility=['//visibility:public'],
    deps=[
        ':admin_lib',
        ':binary_main_lib'
    ]
)

cc_library(
    name='worker_lib',
    srcs=glob(['agent_worker.cc']),
    hdrs=glob(['agent_worker.h']),
    copts=['-Werror'],
    include_prefix='engine',
    deps=[
        ':worker_base_lib',
        ':worker_modules_lib',
    ],
    alwayslink=1
)

cc_binary(
    name='worker_bin',
    srcs=['agent_worker_creator.cc'],
    copts=['-Werror'],
    visibility=['//visibility:public'],
    deps=[
        ':worker_lib',
        ':binary_main_lib'
    ]
)
